---
package:
    name: busybox
    description: Busybox
    version: 1.21.1
    dependencies:
        - glibc: ">=2.12"

sources:
    - file: busybox-1.21.1.tar.bz2
      digest: sha1:9244187d8d30447e165c694e89f4731c1705a53b
      origins:
        - http://busybox.net/downloads/busybox-1.21.1.tar.bz2

build:
    - commands:
        - tar jxf $_SRCDIR/busybox-1.21.1.tar.bz2
        - mkdir -p busybox-full busybox-initrd
        - make -C busybox-1.21.1 defconfig O=$_BLDDIR/busybox-full
        - make -C busybox-1.21.1 defconfig O=$_BLDDIR/busybox-initrd
    
    - workdir: busybox-full
      commands:
        - cp -f $_PKGDIR/config-1.21.1 .config
        - sed -i -r "s|^(CONFIG_SYSROOT=).*$|\\1\"$_RELBASE/$_DEP_GLIBC\"|" .config
        - sed -i -r "s|^(CONFIG_PREFIX=).*$|\\1\"$_RELDIR/full\"|" .config
        - make oldconfig
        - make V=1
        - make install

    - workdir: busybox-initrd
      commands:
        - cp -f $_PKGDIR/config-1.21.1-initrd .config
        - sed -i -r "s|^(CONFIG_SYSROOT=).*$|\\1\"$_RELBASE/$_DEP_GLIBC\"|" .config
        - sed -i -r "s|^(CONFIG_PREFIX=).*$|\\1\"$_RELDIR/initrd\"|" .config
        - make oldconfig
        - make V=1
        - make install